"use strict";(self["webpackChunkmemo_letter"]=self["webpackChunkmemo_letter"]||[]).push([[208],{6208:function(e,t,n){n.r(t),n.d(t,{amplify_chatbot:function(){return on}});n(1703),n(8675),n(3462);var i,o,r,a,s,u,c,l,d,p,f,m,h,v,g,b,y,x,w,S,T,C,E,L,I,A,k,N,z,_,R,P,B,O,F,M,U,$=n(4916),D=n(40),j=n(1814),q=n(4001),G=n(8035),V=n(4171),J=n(7429),H=function(){return H=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},H.apply(this,arguments)},W=new D.k("AbstractInteractionsProvider"),Q=function(){function e(e){void 0===e&&(e={}),this._config=e}return e.prototype.configure=function(e){return void 0===e&&(e={}),this._config=H(H({},this._config),e),W.debug("configure "+this.getProviderName(),this._config),this.options},e.prototype.getCategory=function(){return"Interactions"},Object.defineProperty(e.prototype,"options",{get:function(){return H({},this._config)},enumerable:!0,configurable:!0}),e}(),X=n(2900),Y={i8:"3.6.1"},Z=n(8485),K=n(4805),ee=n(3414),te=n(9836),ne=n(316),ie=n(144),oe=n(8683),re=n(5798),ae="runtime.lex.{region}.amazonaws.com",se="runtime.lex.{region}.amazonaws.com.cn",ue="runtime.lex.{region}.c2s.ic.gov",ce="runtime.lex.{region}.sc2s.sgov.gov",le="runtime.lex.{region}.amazonaws.com",de=new Set(["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","eu-central-1","eu-north-1","eu-south-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-west-1","us-west-2"]),pe=new Set(["cn-north-1","cn-northwest-1"]),fe=new Set(["us-iso-east-1"]),me=new Set(["us-isob-east-1"]),he=new Set(["us-gov-east-1","us-gov-west-1"]),ve=function(e,t){var n=void 0;switch(e){case"ap-northeast-1":n={hostname:"runtime.lex.ap-northeast-1.amazonaws.com",partition:"aws",signingService:"lex"};break;case"ap-southeast-1":n={hostname:"runtime.lex.ap-southeast-1.amazonaws.com",partition:"aws",signingService:"lex"};break;case"ap-southeast-2":n={hostname:"runtime.lex.ap-southeast-2.amazonaws.com",partition:"aws",signingService:"lex"};break;case"eu-central-1":n={hostname:"runtime.lex.eu-central-1.amazonaws.com",partition:"aws",signingService:"lex"};break;case"eu-west-1":n={hostname:"runtime.lex.eu-west-1.amazonaws.com",partition:"aws",signingService:"lex"};break;case"eu-west-2":n={hostname:"runtime.lex.eu-west-2.amazonaws.com",partition:"aws",signingService:"lex"};break;case"us-east-1":n={hostname:"runtime.lex.us-east-1.amazonaws.com",partition:"aws",signingService:"lex"};break;case"us-west-2":n={hostname:"runtime.lex.us-west-2.amazonaws.com",partition:"aws",signingService:"lex"};break;default:de.has(e)&&(n={hostname:ae.replace("{region}",e),partition:"aws",signingService:"lex"}),pe.has(e)&&(n={hostname:se.replace("{region}",e),partition:"aws-cn"}),fe.has(e)&&(n={hostname:ue.replace("{region}",e),partition:"aws-iso"}),me.has(e)&&(n={hostname:ce.replace("{region}",e),partition:"aws-iso-b"}),he.has(e)&&(n={hostname:le.replace("{region}",e),partition:"aws-us-gov"}),void 0===n&&(n={hostname:ae.replace("{region}",e),partition:"aws",signingService:"lex"})}return Promise.resolve((0,X.pi)({signingService:"lex"},n))},ge=n(4343),be={apiVersion:"2016-11-28",disableHostPrefix:!1,logger:{},regionInfoProvider:ve,serviceId:"Lex Runtime Service",urlParser:ge.e},ye=(0,X.pi)((0,X.pi)({},be),{runtime:"browser",base64Decoder:ne.G,base64Encoder:ne.s,bodyLengthChecker:ie.W,credentialDefaultProvider:function(e){return function(){return Promise.reject(new Error("Credential is missing"))}},defaultUserAgentProvider:(0,oe.f)({serviceId:be.serviceId,clientVersion:Y.i8}),maxAttempts:te.J,region:(0,ee.n)("Region is missing"),requestHandler:new K.B,sha256:Z.Sha256,streamCollector:K.C,utf8Decoder:re.fromUtf8,utf8Encoder:re.toUtf8}),xe=n(9137),we=n(900),Se=n(7809),Te=n(6745),Ce=n(9201),Ee=n(9952),Le=n(3220),Ie=function(e){function t(t){var n=this,i=(0,X.pi)((0,X.pi)({},ye),t),o=(0,xe.Xb)(i),r=(0,xe.g4)(o),a=(0,Ce.A$)(r),s=(0,te.BC)(a),u=(0,Se.S8)(s),c=(0,Ee.er)(u);return n=e.call(this,c)||this,n.config=c,n.middlewareStack.use((0,Ce.yt)(n.config)),n.middlewareStack.use((0,te.NQ)(n.config)),n.middlewareStack.use((0,we.VG)(n.config)),n.middlewareStack.use((0,Se.G2)(n.config)),n.middlewareStack.use((0,Te.cV)(n.config)),n.middlewareStack.use((0,Ee.XJ)(n.config)),n}return(0,X.ZT)(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t}(Le.KU);(function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}})(i||(i={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)({},e),e.parameters&&{parameters:Le.oc})}}(o||(o={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(r||(r={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(a||(a={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(s||(s={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(u||(u={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(c||(c={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(l||(l={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(d||(d={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(p||(p={})),function(e){e["FAILED"]="Failed",e["FULFILLED"]="Fulfilled",e["READY_FOR_FULFILLMENT"]="ReadyForFulfillment"}(f||(f={})),function(e){e["COMPOSITE"]="Composite",e["CUSTOM_PAYLOAD"]="CustomPayload",e["PLAIN_TEXT"]="PlainText",e["SSML"]="SSML"}(m||(m={})),function(e){e["CLOSE"]="Close",e["CONFIRM_INTENT"]="ConfirmIntent",e["DELEGATE"]="Delegate",e["ELICIT_INTENT"]="ElicitIntent",e["ELICIT_SLOT"]="ElicitSlot"}(h||(h={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)((0,X.pi)({},e),e.slots&&{slots:Le.oc}),e.message&&{message:Le.oc})}}(v||(v={})),function(e){e["CONFIRMED"]="Confirmed",e["DENIED"]="Denied",e["NONE"]="None"}(g||(g={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)({},e),e.slots&&{slots:Le.oc})}}(b||(b={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)({},e),e.recentIntentSummaryView&&{recentIntentSummaryView:e.recentIntentSummaryView.map((function(e){return b.filterSensitiveLog(e)}))}),e.sessionAttributes&&{sessionAttributes:Le.oc}),e.dialogAction&&{dialogAction:v.filterSensitiveLog(e.dialogAction)}),e.activeContexts&&{activeContexts:Le.oc})}}(y||(y={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(x||(x={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(w||(w={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(S||(S={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(T||(T={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)({},e),e.sessionAttributes&&{sessionAttributes:Le.oc}),e.requestAttributes&&{requestAttributes:Le.oc}),e.activeContexts&&{activeContexts:Le.oc})}}(C||(C={})),function(e){e["CONFIRM_INTENT"]="ConfirmIntent",e["ELICIT_INTENT"]="ElicitIntent",e["ELICIT_SLOT"]="ElicitSlot",e["FAILED"]="Failed",e["FULFILLED"]="Fulfilled",e["READY_FOR_FULFILLMENT"]="ReadyForFulfillment"}(E||(E={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)((0,X.pi)({},e),e.message&&{message:Le.oc}),e.activeContexts&&{activeContexts:Le.oc})}}(L||(L={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(I||(I={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(A||(A={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)({},e),e.sessionAttributes&&{sessionAttributes:Le.oc}),e.requestAttributes&&{requestAttributes:Le.oc}),e.inputText&&{inputText:Le.oc}),e.activeContexts&&{activeContexts:Le.oc})}}(k||(k={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(N||(N={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)({},e),e.slots&&{slots:Le.oc})}}(z||(z={})),function(e){e["GENERIC"]="application/vnd.amazonaws.card.generic"}(_||(_={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(R||(R={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(P||(P={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(B||(B={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)({},e)}}(O||(O={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)({},e),e.alternativeIntents&&{alternativeIntents:e.alternativeIntents.map((function(e){return z.filterSensitiveLog(e)}))}),e.slots&&{slots:Le.oc}),e.sessionAttributes&&{sessionAttributes:Le.oc}),e.message&&{message:Le.oc}),e.activeContexts&&{activeContexts:Le.oc})}}(F||(F={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)({},e),e.sessionAttributes&&{sessionAttributes:Le.oc}),e.dialogAction&&{dialogAction:v.filterSensitiveLog(e.dialogAction)}),e.recentIntentSummaryView&&{recentIntentSummaryView:e.recentIntentSummaryView.map((function(e){return b.filterSensitiveLog(e)}))}),e.activeContexts&&{activeContexts:Le.oc})}}(M||(M={})),function(e){e.filterSensitiveLog=function(e){return(0,X.pi)((0,X.pi)((0,X.pi)({},e),e.message&&{message:Le.oc}),e.activeContexts&&{activeContexts:Le.oc})}}(U||(U={}));var Ae=n(12),ke=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var n,i,o,r,a,s,u,c,l;return(0,X.Jh)(this,(function(d){switch(d.label){case 0:if(n=(0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)({"content-type":"application/octet-stream","x-amz-content-sha256":"UNSIGNED-PAYLOAD"},mt(e.sessionAttributes)&&{"x-amz-lex-session-attributes":Buffer.from(Le.QT.fromObject(e.sessionAttributes)).toString("base64")}),mt(e.requestAttributes)&&{"x-amz-lex-request-attributes":Buffer.from(Le.QT.fromObject(e.requestAttributes)).toString("base64")}),mt(e.contentType)&&{"content-type":e.contentType}),mt(e.accept)&&{accept:e.accept}),mt(e.activeContexts)&&{"x-amz-lex-active-contexts":Buffer.from(Le.QT.fromObject(e.activeContexts)).toString("base64")}),i="/bot/{botName}/alias/{botAlias}/user/{userId}/content",void 0===e.botName)throw new Error("No value provided for input HTTP label: botName.");if(o=e.botName,o.length<=0)throw new Error("Empty value provided for input HTTP label: botName.");if(i=i.replace("{botName}",(0,Le.jc)(o)),void 0===e.botAlias)throw new Error("No value provided for input HTTP label: botAlias.");if(o=e.botAlias,o.length<=0)throw new Error("Empty value provided for input HTTP label: botAlias.");if(i=i.replace("{botAlias}",(0,Le.jc)(o)),void 0===e.userId)throw new Error("No value provided for input HTTP label: userId.");if(o=e.userId,o.length<=0)throw new Error("Empty value provided for input HTTP label: userId.");return i=i.replace("{userId}",(0,Le.jc)(o)),void 0!==e.inputStream&&(r=e.inputStream),[4,t.endpoint()];case 1:return a=d.sent(),s=a.hostname,u=a.protocol,c=void 0===u?"https":u,l=a.port,[2,new Ae.aW({protocol:c,hostname:s,port:l,method:"POST",headers:n,path:i,body:r})]}}))}))},Ne=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var n,i,o,r,a,s,u,c,l;return(0,X.Jh)(this,(function(d){switch(d.label){case 0:if(n={"content-type":"application/json"},i="/bot/{botName}/alias/{botAlias}/user/{userId}/text",void 0===e.botName)throw new Error("No value provided for input HTTP label: botName.");if(o=e.botName,o.length<=0)throw new Error("Empty value provided for input HTTP label: botName.");if(i=i.replace("{botName}",(0,Le.jc)(o)),void 0===e.botAlias)throw new Error("No value provided for input HTTP label: botAlias.");if(o=e.botAlias,o.length<=0)throw new Error("Empty value provided for input HTTP label: botAlias.");if(i=i.replace("{botAlias}",(0,Le.jc)(o)),void 0===e.userId)throw new Error("No value provided for input HTTP label: userId.");if(o=e.userId,o.length<=0)throw new Error("Empty value provided for input HTTP label: userId.");return i=i.replace("{userId}",(0,Le.jc)(o)),r=JSON.stringify((0,X.pi)((0,X.pi)((0,X.pi)((0,X.pi)({},void 0!==e.activeContexts&&null!==e.activeContexts&&{activeContexts:We(e.activeContexts,t)}),void 0!==e.inputText&&null!==e.inputText&&{inputText:e.inputText}),void 0!==e.requestAttributes&&null!==e.requestAttributes&&{requestAttributes:Xe(e.requestAttributes,t)}),void 0!==e.sessionAttributes&&null!==e.sessionAttributes&&{sessionAttributes:Xe(e.sessionAttributes,t)})),[4,t.endpoint()];case 1:return a=d.sent(),s=a.hostname,u=a.protocol,c=void 0===u?"https":u,l=a.port,[2,new Ae.aW({protocol:c,hostname:s,port:l,method:"POST",headers:n,path:i,body:r})]}}))}))},ze=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var n,i;return(0,X.Jh)(this,(function(o){return 200!==e.statusCode&&e.statusCode>=300?[2,_e(e,t)]:(n={$metadata:dt(e),activeContexts:void 0,alternativeIntents:void 0,audioStream:void 0,botVersion:void 0,contentType:void 0,dialogState:void 0,inputTranscript:void 0,intentName:void 0,message:void 0,messageFormat:void 0,nluIntentConfidence:void 0,sentimentResponse:void 0,sessionAttributes:void 0,sessionId:void 0,slotToElicit:void 0,slots:void 0},void 0!==e.headers["content-type"]&&(n.contentType=e.headers["content-type"]),void 0!==e.headers["x-amz-lex-intent-name"]&&(n.intentName=e.headers["x-amz-lex-intent-name"]),void 0!==e.headers["x-amz-lex-nlu-intent-confidence"]&&(n.nluIntentConfidence=new Le.QT(Buffer.from(e.headers["x-amz-lex-nlu-intent-confidence"],"base64").toString("ascii"))),void 0!==e.headers["x-amz-lex-alternative-intents"]&&(n.alternativeIntents=new Le.QT(Buffer.from(e.headers["x-amz-lex-alternative-intents"],"base64").toString("ascii"))),void 0!==e.headers["x-amz-lex-slots"]&&(n.slots=new Le.QT(Buffer.from(e.headers["x-amz-lex-slots"],"base64").toString("ascii"))),void 0!==e.headers["x-amz-lex-session-attributes"]&&(n.sessionAttributes=new Le.QT(Buffer.from(e.headers["x-amz-lex-session-attributes"],"base64").toString("ascii"))),void 0!==e.headers["x-amz-lex-sentiment"]&&(n.sentimentResponse=e.headers["x-amz-lex-sentiment"]),void 0!==e.headers["x-amz-lex-message"]&&(n.message=e.headers["x-amz-lex-message"]),void 0!==e.headers["x-amz-lex-message-format"]&&(n.messageFormat=e.headers["x-amz-lex-message-format"]),void 0!==e.headers["x-amz-lex-dialog-state"]&&(n.dialogState=e.headers["x-amz-lex-dialog-state"]),void 0!==e.headers["x-amz-lex-slot-to-elicit"]&&(n.slotToElicit=e.headers["x-amz-lex-slot-to-elicit"]),void 0!==e.headers["x-amz-lex-input-transcript"]&&(n.inputTranscript=e.headers["x-amz-lex-input-transcript"]),void 0!==e.headers["x-amz-lex-bot-version"]&&(n.botVersion=e.headers["x-amz-lex-bot-version"]),void 0!==e.headers["x-amz-lex-session-id"]&&(n.sessionId=e.headers["x-amz-lex-session-id"]),void 0!==e.headers["x-amz-lex-active-contexts"]&&(n.activeContexts=new Le.QT(Buffer.from(e.headers["x-amz-lex-active-contexts"],"base64").toString("ascii"))),i=e.body,n.audioStream=i,[2,Promise.resolve(n)])}))}))},_e=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var n,i,o,r,a,s,u,c,l,d,p,f,m,h,v,g,b,y,x;return(0,X.Jh)(this,(function(w){switch(w.label){case 0:return i=[(0,X.pi)({},e)],x={},[4,ht(e.body,t)];case 1:switch(n=X.pi.apply(void 0,i.concat([(x.body=w.sent(),x)])),r="UnknownError",r=vt(e,n.body),a=r,a){case"BadGatewayException":return[3,2];case"com.amazonaws.lexruntimeservice#BadGatewayException":return[3,2];case"BadRequestException":return[3,4];case"com.amazonaws.lexruntimeservice#BadRequestException":return[3,4];case"ConflictException":return[3,6];case"com.amazonaws.lexruntimeservice#ConflictException":return[3,6];case"DependencyFailedException":return[3,8];case"com.amazonaws.lexruntimeservice#DependencyFailedException":return[3,8];case"InternalFailureException":return[3,10];case"com.amazonaws.lexruntimeservice#InternalFailureException":return[3,10];case"LimitExceededException":return[3,12];case"com.amazonaws.lexruntimeservice#LimitExceededException":return[3,12];case"LoopDetectedException":return[3,14];case"com.amazonaws.lexruntimeservice#LoopDetectedException":return[3,14];case"NotAcceptableException":return[3,16];case"com.amazonaws.lexruntimeservice#NotAcceptableException":return[3,16];case"NotFoundException":return[3,18];case"com.amazonaws.lexruntimeservice#NotFoundException":return[3,18];case"RequestTimeoutException":return[3,20];case"com.amazonaws.lexruntimeservice#RequestTimeoutException":return[3,20];case"UnsupportedMediaTypeException":return[3,22];case"com.amazonaws.lexruntimeservice#UnsupportedMediaTypeException":return[3,22]}return[3,24];case 2:return s=[{}],[4,Be(n,t)];case 3:return o=X.pi.apply(void 0,[X.pi.apply(void 0,s.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 4:return u=[{}],[4,Oe(n,t)];case 5:return o=X.pi.apply(void 0,[X.pi.apply(void 0,u.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 6:return c=[{}],[4,Fe(n,t)];case 7:return o=X.pi.apply(void 0,[X.pi.apply(void 0,c.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 8:return l=[{}],[4,Me(n,t)];case 9:return o=X.pi.apply(void 0,[X.pi.apply(void 0,l.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 10:return d=[{}],[4,Ue(n,t)];case 11:return o=X.pi.apply(void 0,[X.pi.apply(void 0,d.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 12:return p=[{}],[4,$e(n,t)];case 13:return o=X.pi.apply(void 0,[X.pi.apply(void 0,p.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 14:return f=[{}],[4,De(n,t)];case 15:return o=X.pi.apply(void 0,[X.pi.apply(void 0,f.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 16:return m=[{}],[4,je(n,t)];case 17:return o=X.pi.apply(void 0,[X.pi.apply(void 0,m.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 18:return h=[{}],[4,qe(n,t)];case 19:return o=X.pi.apply(void 0,[X.pi.apply(void 0,h.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 20:return v=[{}],[4,Ge(n,t)];case 21:return o=X.pi.apply(void 0,[X.pi.apply(void 0,v.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 22:return g=[{}],[4,Ve(n,t)];case 23:return o=X.pi.apply(void 0,[X.pi.apply(void 0,g.concat([w.sent()])),{name:r,$metadata:dt(e)}]),[3,25];case 24:b=n.body,r=b.code||b.Code||r,o=(0,X.pi)((0,X.pi)({},b),{name:""+r,message:b.message||b.Message||r,$fault:"client",$metadata:dt(e)}),w.label=25;case 25:return y=o.message||o.Message||r,o.message=y,delete o.Message,[2,Promise.reject(Object.assign(new Error(y),o))]}}))}))},Re=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var n,i;return(0,X.Jh)(this,(function(o){switch(o.label){case 0:return 200!==e.statusCode&&e.statusCode>=300?[2,Pe(e,t)]:(n={$metadata:dt(e),activeContexts:void 0,alternativeIntents:void 0,botVersion:void 0,dialogState:void 0,intentName:void 0,message:void 0,messageFormat:void 0,nluIntentConfidence:void 0,responseCard:void 0,sentimentResponse:void 0,sessionAttributes:void 0,sessionId:void 0,slotToElicit:void 0,slots:void 0},[4,ht(e.body,t)]);case 1:return i=o.sent(),void 0!==i.activeContexts&&null!==i.activeContexts&&(n.activeContexts=Ke(i.activeContexts,t)),void 0!==i.alternativeIntents&&null!==i.alternativeIntents&&(n.alternativeIntents=rt(i.alternativeIntents,t)),void 0!==i.botVersion&&null!==i.botVersion&&(n.botVersion=i.botVersion),void 0!==i.dialogState&&null!==i.dialogState&&(n.dialogState=i.dialogState),void 0!==i.intentName&&null!==i.intentName&&(n.intentName=i.intentName),void 0!==i.message&&null!==i.message&&(n.message=i.message),void 0!==i.messageFormat&&null!==i.messageFormat&&(n.messageFormat=i.messageFormat),void 0!==i.nluIntentConfidence&&null!==i.nluIntentConfidence&&(n.nluIntentConfidence=ot(i.nluIntentConfidence,t)),void 0!==i.responseCard&&null!==i.responseCard&&(n.responseCard=ut(i.responseCard,t)),void 0!==i.sentimentResponse&&null!==i.sentimentResponse&&(n.sentimentResponse=ct(i.sentimentResponse,t)),void 0!==i.sessionAttributes&&null!==i.sessionAttributes&&(n.sessionAttributes=lt(i.sessionAttributes,t)),void 0!==i.sessionId&&null!==i.sessionId&&(n.sessionId=i.sessionId),void 0!==i.slotToElicit&&null!==i.slotToElicit&&(n.slotToElicit=i.slotToElicit),void 0!==i.slots&&null!==i.slots&&(n.slots=lt(i.slots,t)),[2,Promise.resolve(n)]}}))}))},Pe=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var n,i,o,r,a,s,u,c,l,d,p,f,m,h,v,g;return(0,X.Jh)(this,(function(b){switch(b.label){case 0:return i=[(0,X.pi)({},e)],g={},[4,ht(e.body,t)];case 1:switch(n=X.pi.apply(void 0,i.concat([(g.body=b.sent(),g)])),r="UnknownError",r=vt(e,n.body),a=r,a){case"BadGatewayException":return[3,2];case"com.amazonaws.lexruntimeservice#BadGatewayException":return[3,2];case"BadRequestException":return[3,4];case"com.amazonaws.lexruntimeservice#BadRequestException":return[3,4];case"ConflictException":return[3,6];case"com.amazonaws.lexruntimeservice#ConflictException":return[3,6];case"DependencyFailedException":return[3,8];case"com.amazonaws.lexruntimeservice#DependencyFailedException":return[3,8];case"InternalFailureException":return[3,10];case"com.amazonaws.lexruntimeservice#InternalFailureException":return[3,10];case"LimitExceededException":return[3,12];case"com.amazonaws.lexruntimeservice#LimitExceededException":return[3,12];case"LoopDetectedException":return[3,14];case"com.amazonaws.lexruntimeservice#LoopDetectedException":return[3,14];case"NotFoundException":return[3,16];case"com.amazonaws.lexruntimeservice#NotFoundException":return[3,16]}return[3,18];case 2:return s=[{}],[4,Be(n,t)];case 3:return o=X.pi.apply(void 0,[X.pi.apply(void 0,s.concat([b.sent()])),{name:r,$metadata:dt(e)}]),[3,19];case 4:return u=[{}],[4,Oe(n,t)];case 5:return o=X.pi.apply(void 0,[X.pi.apply(void 0,u.concat([b.sent()])),{name:r,$metadata:dt(e)}]),[3,19];case 6:return c=[{}],[4,Fe(n,t)];case 7:return o=X.pi.apply(void 0,[X.pi.apply(void 0,c.concat([b.sent()])),{name:r,$metadata:dt(e)}]),[3,19];case 8:return l=[{}],[4,Me(n,t)];case 9:return o=X.pi.apply(void 0,[X.pi.apply(void 0,l.concat([b.sent()])),{name:r,$metadata:dt(e)}]),[3,19];case 10:return d=[{}],[4,Ue(n,t)];case 11:return o=X.pi.apply(void 0,[X.pi.apply(void 0,d.concat([b.sent()])),{name:r,$metadata:dt(e)}]),[3,19];case 12:return p=[{}],[4,$e(n,t)];case 13:return o=X.pi.apply(void 0,[X.pi.apply(void 0,p.concat([b.sent()])),{name:r,$metadata:dt(e)}]),[3,19];case 14:return f=[{}],[4,De(n,t)];case 15:return o=X.pi.apply(void 0,[X.pi.apply(void 0,f.concat([b.sent()])),{name:r,$metadata:dt(e)}]),[3,19];case 16:return m=[{}],[4,qe(n,t)];case 17:return o=X.pi.apply(void 0,[X.pi.apply(void 0,m.concat([b.sent()])),{name:r,$metadata:dt(e)}]),[3,19];case 18:h=n.body,r=h.code||h.Code||r,o=(0,X.pi)((0,X.pi)({},h),{name:""+r,message:h.message||h.Message||r,$fault:"client",$metadata:dt(e)}),b.label=19;case 19:return v=o.message||o.Message||r,o.message=v,delete o.Message,[2,Promise.reject(Object.assign(new Error(v),o))]}}))}))},Be=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"BadGatewayException",$fault:"server",$metadata:dt(e),Message:void 0},n=e.body,void 0!==n.Message&&null!==n.Message&&(t.Message=n.Message),[2,t]}))}))},Oe=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"BadRequestException",$fault:"client",$metadata:dt(e),message:void 0},n=e.body,void 0!==n.message&&null!==n.message&&(t.message=n.message),[2,t]}))}))},Fe=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"ConflictException",$fault:"client",$metadata:dt(e),message:void 0},n=e.body,void 0!==n.message&&null!==n.message&&(t.message=n.message),[2,t]}))}))},Me=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"DependencyFailedException",$fault:"client",$metadata:dt(e),Message:void 0},n=e.body,void 0!==n.Message&&null!==n.Message&&(t.Message=n.Message),[2,t]}))}))},Ue=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"InternalFailureException",$fault:"server",$metadata:dt(e),message:void 0},n=e.body,void 0!==n.message&&null!==n.message&&(t.message=n.message),[2,t]}))}))},$e=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"LimitExceededException",$fault:"client",$metadata:dt(e),message:void 0,retryAfterSeconds:void 0},void 0!==e.headers["retry-after"]&&(t.retryAfterSeconds=e.headers["retry-after"]),n=e.body,void 0!==n.message&&null!==n.message&&(t.message=n.message),[2,t]}))}))},De=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"LoopDetectedException",$fault:"server",$metadata:dt(e),Message:void 0},n=e.body,void 0!==n.Message&&null!==n.Message&&(t.Message=n.Message),[2,t]}))}))},je=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"NotAcceptableException",$fault:"client",$metadata:dt(e),message:void 0},n=e.body,void 0!==n.message&&null!==n.message&&(t.message=n.message),[2,t]}))}))},qe=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"NotFoundException",$fault:"client",$metadata:dt(e),message:void 0},n=e.body,void 0!==n.message&&null!==n.message&&(t.message=n.message),[2,t]}))}))},Ge=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"RequestTimeoutException",$fault:"client",$metadata:dt(e),message:void 0},n=e.body,void 0!==n.message&&null!==n.message&&(t.message=n.message),[2,t]}))}))},Ve=function(e,t){return(0,X.mG)(void 0,void 0,void 0,(function(){var t,n;return(0,X.Jh)(this,(function(i){return t={name:"UnsupportedMediaTypeException",$fault:"client",$metadata:dt(e),message:void 0},n=e.body,void 0!==n.message&&null!==n.message&&(t.message=n.message),[2,t]}))}))},Je=function(e,t){return(0,X.pi)((0,X.pi)((0,X.pi)({},void 0!==e.name&&null!==e.name&&{name:e.name}),void 0!==e.parameters&&null!==e.parameters&&{parameters:He(e.parameters,t)}),void 0!==e.timeToLive&&null!==e.timeToLive&&{timeToLive:Qe(e.timeToLive,t)})},He=function(e,t){return Object.entries(e).reduce((function(e,t){var n,i=(0,X.CR)(t,2),o=i[0],r=i[1];return null===r?e:(0,X.pi)((0,X.pi)({},e),(n={},n[o]=r,n))}),{})},We=function(e,t){return e.filter((function(e){return null!=e})).map((function(e){return null===e?null:Je(e,t)}))},Qe=function(e,t){return(0,X.pi)((0,X.pi)({},void 0!==e.timeToLiveInSeconds&&null!==e.timeToLiveInSeconds&&{timeToLiveInSeconds:e.timeToLiveInSeconds}),void 0!==e.turnsToLive&&null!==e.turnsToLive&&{turnsToLive:e.turnsToLive})},Xe=function(e,t){return Object.entries(e).reduce((function(e,t){var n,i=(0,X.CR)(t,2),o=i[0],r=i[1];return null===r?e:(0,X.pi)((0,X.pi)({},e),(n={},n[o]=r,n))}),{})},Ye=function(e,t){return{name:void 0!==e.name&&null!==e.name?e.name:void 0,parameters:void 0!==e.parameters&&null!==e.parameters?Ze(e.parameters,t):void 0,timeToLive:void 0!==e.timeToLive&&null!==e.timeToLive?et(e.timeToLive,t):void 0}},Ze=function(e,t){return Object.entries(e).reduce((function(e,t){var n,i=(0,X.CR)(t,2),o=i[0],r=i[1];return null===r?e:(0,X.pi)((0,X.pi)({},e),(n={},n[o]=r,n))}),{})},Ke=function(e,t){return(e||[]).filter((function(e){return null!=e})).map((function(e){return null===e?null:Ye(e,t)}))},et=function(e,t){return{timeToLiveInSeconds:void 0!==e.timeToLiveInSeconds&&null!==e.timeToLiveInSeconds?e.timeToLiveInSeconds:void 0,turnsToLive:void 0!==e.turnsToLive&&null!==e.turnsToLive?e.turnsToLive:void 0}},tt=function(e,t){return{text:void 0!==e.text&&null!==e.text?e.text:void 0,value:void 0!==e.value&&null!==e.value?e.value:void 0}},nt=function(e,t){return{attachmentLinkUrl:void 0!==e.attachmentLinkUrl&&null!==e.attachmentLinkUrl?e.attachmentLinkUrl:void 0,buttons:void 0!==e.buttons&&null!==e.buttons?at(e.buttons,t):void 0,imageUrl:void 0!==e.imageUrl&&null!==e.imageUrl?e.imageUrl:void 0,subTitle:void 0!==e.subTitle&&null!==e.subTitle?e.subTitle:void 0,title:void 0!==e.title&&null!==e.title?e.title:void 0}},it=function(e,t){return(e||[]).filter((function(e){return null!=e})).map((function(e){return null===e?null:nt(e,t)}))},ot=function(e,t){return{score:void 0!==e.score&&null!==e.score?e.score:void 0}},rt=function(e,t){return(e||[]).filter((function(e){return null!=e})).map((function(e){return null===e?null:st(e,t)}))},at=function(e,t){return(e||[]).filter((function(e){return null!=e})).map((function(e){return null===e?null:tt(e,t)}))},st=function(e,t){return{intentName:void 0!==e.intentName&&null!==e.intentName?e.intentName:void 0,nluIntentConfidence:void 0!==e.nluIntentConfidence&&null!==e.nluIntentConfidence?ot(e.nluIntentConfidence,t):void 0,slots:void 0!==e.slots&&null!==e.slots?lt(e.slots,t):void 0}},ut=function(e,t){return{contentType:void 0!==e.contentType&&null!==e.contentType?e.contentType:void 0,genericAttachments:void 0!==e.genericAttachments&&null!==e.genericAttachments?it(e.genericAttachments,t):void 0,version:void 0!==e.version&&null!==e.version?e.version:void 0}},ct=function(e,t){return{sentimentLabel:void 0!==e.sentimentLabel&&null!==e.sentimentLabel?e.sentimentLabel:void 0,sentimentScore:void 0!==e.sentimentScore&&null!==e.sentimentScore?e.sentimentScore:void 0}},lt=function(e,t){return Object.entries(e).reduce((function(e,t){var n,i=(0,X.CR)(t,2),o=i[0],r=i[1];return null===r?e:(0,X.pi)((0,X.pi)({},e),(n={},n[o]=r,n))}),{})},dt=function(e){var t;return{httpStatusCode:e.statusCode,requestId:null!==(t=e.headers["x-amzn-requestid"])&&void 0!==t?t:e.headers["x-amzn-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}},pt=function(e,t){return void 0===e&&(e=new Uint8Array),e instanceof Uint8Array?Promise.resolve(e):t.streamCollector(e)||Promise.resolve(new Uint8Array)},ft=function(e,t){return pt(e,t).then((function(e){return t.utf8Encoder(e)}))},mt=function(e){return void 0!==e&&null!==e&&""!==e&&(!Object.getOwnPropertyNames(e).includes("length")||0!=e.length)&&(!Object.getOwnPropertyNames(e).includes("size")||0!=e.size)},ht=function(e,t){return ft(e,t).then((function(e){return e.length?JSON.parse(e):{}}))},vt=function(e,t){var n=function(e,t){return Object.keys(e).find((function(e){return e.toLowerCase()===t.toLowerCase()}))},i=function(e){var t=e;return t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},o=n(e.headers,"x-amzn-errortype");return void 0!==o?i(e.headers[o]):void 0!==t.code?i(t.code):void 0!==t["__type"]?i(t["__type"]):""},gt=n(6005),bt=function(e){function t(t){var n=e.call(this)||this;return n.input=t,n}return(0,X.ZT)(t,e),t.prototype.resolveMiddleware=function(e,t,n){this.middlewareStack.use((0,gt.p2)(t,this.serialize,this.deserialize));var i=e.concat(this.middlewareStack),o=t.logger,r="LexRuntimeServiceClient",a="PostTextCommand",s={logger:o,clientName:r,commandName:a,inputFilterSensitiveLog:k.filterSensitiveLog,outputFilterSensitiveLog:F.filterSensitiveLog},u=t.requestHandler;return i.resolve((function(e){return u.handle(e.request,n||{})}),s)},t.prototype.serialize=function(e,t){return Ne(e,t)},t.prototype.deserialize=function(e,t){return Re(e,t)},t}(Le.mY),yt=function(e){function t(t){var n=e.call(this)||this;return n.input=t,n}return(0,X.ZT)(t,e),t.prototype.resolveMiddleware=function(e,t,n){this.middlewareStack.use((0,gt.p2)(t,this.serialize,this.deserialize));var i=e.concat(this.middlewareStack),o=t.logger,r="LexRuntimeServiceClient",a="PostContentCommand",s={logger:o,clientName:r,commandName:a,inputFilterSensitiveLog:C.filterSensitiveLog,outputFilterSensitiveLog:L.filterSensitiveLog},u=t.requestHandler;return i.resolve((function(e){return u.handle(e.request,n||{})}),s)},t.prototype.serialize=function(e,t){return ke(e,t)},t.prototype.deserialize=function(e,t){return ze(e,t)},t}(Le.mY),xt=n(4869),wt=n(7572),St=function(e){if(e instanceof Blob||e instanceof ReadableStream)return new Response(e).arrayBuffer().then((function(e){return new Uint8Array(e)}));throw new Error("Readable is not supported.")},Tt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Ct=function(){return Ct=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ct.apply(this,arguments)},Et=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function a(e){try{u(i.next(e))}catch(t){r(t)}}function s(e){try{u(i["throw"](e))}catch(t){r(t)}}function u(e){e.done?n(e.value):o(e.value).then(a,s)}u((i=i.apply(e,t||[])).next())}))},Lt=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return u([e,t])}}function u(r){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,i&&(o=2&r[0]?i["return"]:r[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},It=new D.k("AWSLexProvider"),At=function(e){function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;return n._botsCompleteCallback={},n}return Tt(t,e),t.prototype.getProviderName=function(){return"AWSLexProvider"},t.prototype.reportBotStatus=function(e,t){var n=this;It.debug("postContent state",e.dialogState),"ReadyForFulfillment"!==e.dialogState&&"Fulfilled"!==e.dialogState||("function"===typeof this._botsCompleteCallback[t]&&setTimeout((function(){return n._botsCompleteCallback[t](null,{slots:e.slots})}),0),this._config&&"function"===typeof this._config[t].onComplete&&setTimeout((function(){return n._config[t].onComplete(null,{slots:e.slots})}),0)),"Failed"===e.dialogState&&("function"===typeof this._botsCompleteCallback[t]&&setTimeout((function(){return n._botsCompleteCallback[t]("Bot conversation failed")}),0),this._config&&"function"===typeof this._config[t].onComplete&&setTimeout((function(){return n._config[t].onComplete("Bot conversation failed")}),0))},t.prototype.sendMessage=function(e,t){return Et(this,void 0,void 0,(function(){var n,i,o,r,a,s,u,c,l,d;return Lt(this,(function(p){switch(p.label){case 0:return this._config[e]?[4,xt.cN.get()]:[2,Promise.reject("Bot "+e+" does not exist")];case 1:if(n=p.sent(),!n)return[2,Promise.reject("No credentials")];if(this.lexRuntimeServiceClient=new Ie({region:this._config[e].region,credentials:n,customUserAgent:(0,wt.Zm)()}),"string"!==typeof t)return[3,6];i={botAlias:this._config[e].alias,botName:e,inputText:t,userId:n.identityId},It.debug("postText to lex",t),p.label=2;case 2:return p.trys.push([2,4,,5]),o=new bt(i),[4,this.lexRuntimeServiceClient.send(o)];case 3:return c=p.sent(),this.reportBotStatus(c,e),[2,c];case 4:return r=p.sent(),[2,Promise.reject(r)];case 5:return[3,11];case 6:a=t.content,s=t.options.messageType,i="voice"===s?{botAlias:this._config[e].alias,botName:e,contentType:"audio/x-l16; sample-rate=16000",inputStream:a,userId:n.identityId,accept:"audio/mpeg"}:{botAlias:this._config[e].alias,botName:e,contentType:"text/plain; charset=utf-8",inputStream:a,userId:n.identityId,accept:"audio/mpeg"},It.debug("postContent to lex",t),p.label=7;case 7:return p.trys.push([7,10,,11]),u=new yt(i),[4,this.lexRuntimeServiceClient.send(u)];case 8:return c=p.sent(),[4,St(c.audioStream)];case 9:return l=p.sent(),this.reportBotStatus(c,e),[2,Ct(Ct({},c),{audioStream:l})];case 10:return d=p.sent(),[2,Promise.reject(d)];case 11:return[2]}}))}))},t.prototype.onComplete=function(e,t){if(!this._config[e])throw new ErrorEvent("Bot "+e+" does not exist");this._botsCompleteCallback[e]=t},t}(Q),kt=function(){return kt=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},kt.apply(this,arguments)},Nt=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function a(e){try{u(i.next(e))}catch(t){r(t)}}function s(e){try{u(i["throw"](e))}catch(t){r(t)}}function u(e){e.done?n(e.value):o(e.value).then(a,s)}u((i=i.apply(e,t||[])).next())}))},zt=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return u([e,t])}}function u(r){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,i&&(o=2&r[0]?i["return"]:r[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},_t=new D.k("Interactions"),Rt=function(){function e(e){this._options=e,_t.debug("Interactions Options",this._options),this._pluggables={}}return e.prototype.getModuleName=function(){return"Interactions"},e.prototype.configure=function(e){var t=this,n=e?e.Interactions||e:{};_t.debug("configure Interactions",{opt:n}),this._options=kt(kt({bots:{}},n),n.Interactions);var i=this._options.aws_bots_config,o=this._options.bots;return!Object.keys(o).length&&i&&Array.isArray(i)&&i.forEach((function(e){t._options.bots[e.name]=e})),!this._pluggables.AWSLexProvider&&o&&Object.keys(o).map((function(e){return o[e]})).find((function(e){return!e.providerName||"AWSLexProvider"===e.providerName}))&&(this._pluggables.AWSLexProvider=new At),Object.keys(this._pluggables).map((function(e){t._pluggables[e].configure(t._options.bots)})),this._options},e.prototype.addPluggable=function(e){if(e&&"Interactions"===e.getCategory()){if(this._pluggables[e.getProviderName()])throw new Error("Bot "+e.getProviderName()+" already plugged");return e.configure(this._options.bots),void(this._pluggables[e.getProviderName()]=e)}},e.prototype.send=function(e,t){return Nt(this,void 0,void 0,(function(){var n;return zt(this,(function(i){switch(i.label){case 0:if(!this._options.bots||!this._options.bots[e])throw new Error("Bot "+e+" does not exist");if(n=this._options.bots[e].providerName||"AWSLexProvider",!this._pluggables[n])throw new Error("Bot "+n+" does not have valid pluggin did you try addPluggable first?");return[4,this._pluggables[n].sendMessage(e,t)];case 1:return[2,i.sent()]}}))}))},e.prototype.onComplete=function(e,t){if(!this._options.bots||!this._options.bots[e])throw new Error("Bot "+e+" does not exist");var n=this._options.bots[e].providerName||"AWSLexProvider";if(!this._pluggables[n])throw new Error("Bot "+n+" does not have valid pluggin did you try addPluggable first?");this._pluggables[n].onComplete(e,t)},e}(),Pt=new Rt(null);J.dQ.register(Pt);var Bt,Ot,Ft,Mt=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function a(e){try{u(i.next(e))}catch(t){r(t)}}function s(e){try{u(i["throw"](e))}catch(t){r(t)}}function u(e){e.done?n(e.value):o(e.value).then(a,s)}u((i=i.apply(e,t||[])).next())}))},Ut=function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return u([e,t])}}function u(r){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,i&&(o=2&r[0]?i["return"]:r[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(s){r=[6,s],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},$t=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],a=0,s=r.length;a<s;a++,o++)i[o]=r[a];return i},Dt="application/octet-stream",jt=16e3,qt=2048,Gt=-10,Vt=-90,Jt=.85,Ht=function(e,t){for(var n=new Float32Array(t),i=0,o=0;o<e.length;o++)n.set(e[o],i),i+=e[o].length;return n},Wt=function(e,t,n){if(n===t)return e;var i=t/n,o=Math.round(e.length/i),r=new Float32Array(o),a=0,s=0;while(a<r.length){for(var u=Math.round((a+1)*i),c=0,l=0,d=s;d<u&&d<e.length;d++)c+=e[d],l++;r[a]=c/l,a++,s=u}return r},Qt=function(e,t,n){for(var i=t,o=0;o<n.length;o++,i+=2){var r=Math.max(-1,Math.min(1,n[o]));e.setInt16(i,r<0?32768*r:32767*r,!0)}},Xt=function(e,t,n){for(var i=0;i<n.length;i++)e.setUint8(t+i,n.charCodeAt(i))},Yt=function(e,t){var n=2*e.length,i=24,o=8+n,r=12+i+o,a=new ArrayBuffer(r),s=new DataView(a);return Xt(s,0,"RIFF"),s.setUint32(4,i+o,!0),Xt(s,8,"WAVE"),Xt(s,12,"fmt "),s.setUint32(16,i-8,!0),s.setUint16(20,1,!0),s.setUint16(22,1,!0),s.setUint32(24,t,!0),s.setUint32(28,2*t,!0),s.setUint16(32,2,!0),s.setUint16(34,16,!0),Xt(s,36,"data"),s.setUint32(40,n,!0),Qt(s,44,e),s},Zt=function(e,t,n,i){var o=Ht(e,t),r=Wt(o,n,i),a=Yt(r,i),s=new Blob([a],{type:Dt});return s},Kt=new D.k("AudioRecorder"),en=function(){function e(e){this.streamBuffer=[],this.streamBufferLength=0,this.recording=!1,this.options=e}return e.prototype.init=function(){return Mt(this,void 0,void 0,(function(){var e=this;return Ut(this,(function(t){switch(t.label){case 0:return(0,j.lC)().isBrowser?(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext,[4,navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e.audioSupported=!0,e.setupAudioNodes(t)})).catch((function(){return e.audioSupported=!1,Promise.reject("Audio is not supported")}))]):[3,2];case 1:return t.sent(),[3,3];case 2:return this.audioSupported=!1,[2,Promise.reject("Audio is not supported")];case 3:return[2]}}))}))},e.prototype.setupAudioNodes=function(e){return Mt(this,void 0,void 0,(function(){var t,n,i,o,r=this;return Ut(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.audioContext.resume()];case 1:return a.sent(),[3,3];case 2:return t=a.sent(),Kt.error(t),[3,3];case 3:return n=this.audioContext.createMediaStreamSource(e),i=this.audioContext.createScriptProcessor(4096,1,1),i.onaudioprocess=function(e){if(r.recording){var t=e.inputBuffer.getChannelData(0);r.streamBuffer.push(new Float32Array(t)),r.streamBufferLength+=t.length,r.analyse()}},o=this.audioContext.createAnalyser(),o.minDecibels=Vt,o.maxDecibels=Gt,o.smoothingTimeConstant=Jt,n.connect(o),o.connect(i),i.connect(n.context.destination),this.analyserNode=o,[2]}}))}))},e.prototype.startRecording=function(e,t){return Mt(this,void 0,void 0,(function(){var n,i;return Ut(this,(function(o){switch(o.label){case 0:if(this.recording||!this.audioSupported)return[2];this.onSilence=e||function(){},this.visualizer=t||function(){},n=this.audioContext,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,n.resume()];case 2:return o.sent(),[3,4];case 3:return i=o.sent(),Kt.error(i),[3,4];case 4:return this.start=Date.now(),this.recording=!0,[2]}}))}))},e.prototype.stopRecording=function(){this.audioSupported&&(this.recording=!1)},e.prototype.clear=function(){this.stopRecording(),this.streamBufferLength=0,this.streamBuffer=[]},e.prototype.play=function(e){var t=this;if(e&&this.audioSupported){var n=new Blob([e]);return new Promise((function(e,i){var o=new FileReader;o.onload=function(){t.playbackSource&&t.playbackSource.disconnect(),t.playbackSource=t.audioContext.createBufferSource();var n=function(n){t.playbackSource.buffer=n,t.playbackSource.connect(t.audioContext.destination),t.playbackSource.onended=function(){return e()},t.playbackSource.start(0)},r=function(e){return i(e)};t.audioContext.decodeAudioData(o.result,n,r)},o.onerror=function(){return i()},o.readAsArrayBuffer(n)}))}},e.prototype.stop=function(){this.playbackSource&&this.playbackSource.stop()},e.prototype.analyse=function(){if(this.audioSupported){var e=this.analyserNode;e.fftSize=qt;var t=e.fftSize,n=new Uint8Array(t),i=this.options.amplitude,o=this.options.time;e.getByteTimeDomainData(n),this.visualizer(n,t);for(var r=0;r<t;r++){var a=n[r]/128-1;(a>i||a<-1*i)&&(this.start=Date.now())}var s=Date.now(),u=s-this.start;u>o&&this.onSilence()}},e.prototype.exportWAV=function(e){return void 0===e&&(e=jt),Mt(this,void 0,void 0,(function(){var t,n;return Ut(this,(function(i){return this.audioSupported?(t=this.audioContext.sampleRate,n=Zt(this.streamBuffer,this.streamBufferLength,t,e),this.clear(),[2,n]):[2]}))}))},e}(),tn=function(e,t,n){if(n){if(!(0,j.lC)().isBrowser)throw new Error("Visualization is not supported on non-browsers.");var i=n.getBoundingClientRect(),o=i.width,r=i.height;n.width=o,n.height=r;var a=n.getContext("2d");a.fillStyle="white",a.clearRect(0,0,o,r);var s=function(){a.fillRect(0,0,o,r),a.lineWidth=1;var i=getComputedStyle(document.documentElement).getPropertyValue("--amplify-primary-color");a.strokeStyle=i&&""!==i?i:"#ff9900",a.beginPath();for(var s=1*o/t,u=0,c=0;c<t||c%3===0;c++){var l=e[c]/128,d=l*r/2;0===c?a.moveTo(u,d):a.lineTo(u,d),u+=s}a.lineTo(n.width,n.height/2),a.stroke()};requestAnimationFrame(s)}},nn=".bot .dot{background-color:var(--bot-dot-color)}.user .dot{background-color:var(--user-dot-color)}.dot-flashing{width:2.625rem}.dot-flashing .dot{display:inline-block;width:0.625rem;height:0.625rem;border-radius:10rem;opacity:0.65}.dot-flashing .left{-webkit-animation:dot-flashing 1s infinite alternate;animation:dot-flashing 1s infinite alternate;-webkit-animation-delay:0s;animation-delay:0s}.dot-flashing .middle{margin-left:0.375rem;margin-right:0.375rem;-webkit-animation:dot-flashing 1s infinite linear alternate;animation:dot-flashing 1s infinite linear alternate;-webkit-animation-delay:0.5s;animation-delay:0.5s}.dot-flashing .right{-webkit-animation:dot-flashing 1s infinite alternate;animation:dot-flashing 1s infinite alternate;-webkit-animation-delay:1s;animation-delay:1s}@-webkit-keyframes dot-flashing{0%{opacity:0.65}50%,100%{opacity:0.1}}@keyframes dot-flashing{0%{opacity:0.65}50%,100%{opacity:0.1}}:host{--width:28.75rem;--height:37.5rem;--header-color:var(--amplify-secondary-color);--header-size:var(--amplify-text-lg);--bot-background-color:rgb(230, 230, 230);--bot-text-color:black;--bot-dot-color:var(--bot-text-color);--user-background-color:var(--amplify-blue);--user-text-color:var(--amplify-white);--user-dot-color:var(--user-text-color)}.amplify-chatbot{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-direction:column;flex-direction:column;background-color:var(--background-color);border-radius:0.375rem;-webkit-box-shadow:0.0625rem 0rem 0.25rem 0 rgba(0, 0, 0, 0.15);box-shadow:0.0625rem 0rem 0.25rem 0 rgba(0, 0, 0, 0.15);-webkit-box-sizing:border-box;box-sizing:border-box;font-family:var(--amplify-font-family);margin-bottom:1rem;width:100%;height:var(--height);max-width:var(--width)}@media (min-width: 672px){.amplify-chatbot{width:var(--width)}}.header{padding:1.25rem 0.375rem 1.25rem 0.375rem;color:var(--header-color);font-size:var(--header-size);font-weight:bold;text-align:center;word-wrap:break-word}.body{border-top:0.0625rem solid rgba(0, 0, 0, 0.05);padding:1.5rem 1rem 0 1rem;display:-ms-flexbox;display:flex;-ms-flex-positive:1;flex-grow:1;-ms-flex-direction:column;flex-direction:column;overflow:auto}.bubble{max-width:100%;padding:0.8em 1.4em;text-align:left;word-wrap:break-word;margin-bottom:0.625rem}.bot{margin-right:auto;background-color:var(--bot-background-color);color:var(--bot-text-color);border-radius:1.5rem 1.5rem 1.5rem 0}.user{margin-left:auto;background-color:var(--user-background-color);color:var(--user-text-color);border-radius:1.5rem 1.5rem 0 1.5rem}.footer{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;border-top:0.062rem solid rgba(0, 0, 0, 0.05);padding-right:0.625rem;min-height:3.125rem}.footer amplify-input{--border:none;--margin:0;-ms-flex-positive:1;flex-grow:1}canvas{margin-left:0.625rem;margin-right:0.625rem;-ms-flex-positive:1;flex-grow:1;height:3.125rem}.icon-button{--icon-height:1.25rem;--icon-fill:var(--amplify-primary-color);--padding:0.625rem;--width:auto}";(function(e){e[e["Initial"]=0]="Initial",e[e["Listening"]=1]="Listening",e[e["SendingText"]=2]="SendingText",e[e["SendingVoice"]=3]="SendingVoice",e[e["Error"]=4]="Error"})(Bt||(Bt={})),function(e){e["Bot"]="bot",e["User"]="user"}(Ot||(Ot={})),function(e){e[e["Recoverable"]=0]="Recoverable",e[e["Unrecoverable"]=1]="Unrecoverable"}(Ft||(Ft={}));var on=function(){function e(e){var t=this;(0,$.r)(this,e),this.clearOnComplete=!1,this.conversationModeOn=!1,this.botTitle=G.T.CHATBOT_TITLE,this.voiceEnabled=!1,this.textEnabled=!0,this.silenceTime=1500,this.silenceThreshold=.2,this.messages=[],this.text="",this.chatState=Bt.Initial,this.messageJSX=function(e){var n=e.map((function(e){return(0,$.h)("div",{class:"bubble "+e.from},e.content)}));if(t.chatState===Bt.SendingText||t.chatState===Bt.SendingVoice){var i=t.chatState===Bt.SendingText?Ot.Bot:Ot.User;n.push((0,$.h)("div",{class:"bubble "+i},(0,$.h)("div",{class:"dot-flashing "+i},(0,$.h)("span",{class:"dot left"}),(0,$.h)("span",{class:"dot middle"}),(0,$.h)("span",{class:"dot right"}))))}return n},this.chatCompleted=(0,$.c)(this,"chatCompleted",7)}return e.prototype.submitHandler=function(e){this.sendTextMessage()},e.prototype.componentWillLoad=function(){if(!Pt||"function"!==typeof Pt.onComplete)throw new Error(V.c);this.validateProps()},e.prototype.componentDidRender=function(){var e=this.element.shadowRoot.querySelector(".body");e.scrollTop=e.scrollHeight},e.prototype.validateProps=function(){var e=this;if(this.voiceEnabled||this.textEnabled)if(this.botName){this.welcomeMessage&&this.appendToChat(this.welcomeMessage,Ot.Bot),this.voiceEnabled&&(this.audioRecorder=new en({time:this.silenceTime,amplitude:this.silenceThreshold}),this.audioRecorder.init().catch((function(t){e.setError(t,Ft.Recoverable)})));var t=function(t,n){e.chatCompleted.emit({data:n,err:t}),e.clearOnComplete?e.reset():e.chatState=Bt.Initial};try{Pt.onComplete(this.botName,t)}catch(n){this.setError(n,Ft.Unrecoverable)}}else this.setError(G.T.NO_BOT_NAME_ERROR,Ft.Unrecoverable);else this.setError(G.T.CHAT_DISABLED_ERROR,Ft.Unrecoverable)},e.prototype.handleSubmit=function(e){e.preventDefault(),this.sendTextMessage()},e.prototype.handleMicButton=function(){var e=this;this.chatState===Bt.Initial&&(this.audioRecorder.stop(),this.chatState=Bt.Listening,this.audioRecorder.startRecording((function(){return e.handleSilence()}),(function(t,n){return e.visualizer(t,n)})))},e.prototype.handleSilence=function(){var e=this;this.chatState=Bt.SendingVoice,this.audioRecorder.stopRecording(),this.audioRecorder.exportWAV().then((function(t){e.sendVoiceMessage(t)}))},e.prototype.handleTextChange=function(e){var t=e.target;this.text=t.value},e.prototype.handleCancelButton=function(){this.audioRecorder.clear(),this.chatState=Bt.Initial},e.prototype.handleToastClose=function(e){this.error=void 0,e===Ft.Recoverable&&(this.chatState=Bt.Initial)},e.prototype.visualizer=function(e,t){var n=this.element.shadowRoot.querySelector("canvas");tn(e,t,n)},e.prototype.sendTextMessage=function(){return Mt(this,void 0,void 0,(function(){var e,t,n;return Ut(this,(function(i){switch(i.label){case 0:if(0===this.text.length||this.chatState!==Bt.Initial)return[2];e=this.text,this.text="",this.appendToChat(e,Ot.User),this.chatState=Bt.SendingText,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Pt.send(this.botName,e)];case 2:return t=i.sent(),[3,4];case 3:return n=i.sent(),this.setError(n,Ft.Recoverable),[2];case 4:return t.message&&this.appendToChat(t.message,Ot.Bot),this.chatState=Bt.Initial,[2]}}))}))},e.prototype.sendVoiceMessage=function(e){return Mt(this,void 0,void 0,(function(){var t,n,i,o,r=this;return Ut(this,(function(a){switch(a.label){case 0:t={content:e,options:{messageType:"voice"}},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Pt.send(this.botName,t)];case 2:return n=a.sent(),[3,4];case 3:return i=a.sent(),this.setError(i,Ft.Recoverable),[2];case 4:return this.chatState=Bt.Initial,o=n.dialogState,n.inputTranscript&&this.appendToChat(n.inputTranscript,Ot.User),this.appendToChat(n.message,Ot.Bot),[4,this.audioRecorder.play(n.audioStream).then((function(){r.conversationModeOn&&"Fulfilled"!==o&&"Failed"!==o&&r.chatState===Bt.Initial&&r.handleMicButton()})).catch((function(e){return r.setError(e,Ft.Recoverable)}))];case 5:return a.sent(),[2]}}))}))},e.prototype.appendToChat=function(e,t){this.messages=$t(this.messages,[{content:e,from:t}])},e.prototype.setError=function(e,t){var n="string"===typeof e?e:e.message;this.chatState=Bt.Error,this.error={message:n,errorType:t}},e.prototype.reset=function(){this.chatState=Bt.Initial,this.text="",this.error=void 0,this.messages=[],this.welcomeMessage&&this.appendToChat(this.welcomeMessage,Ot.Bot),this.audioRecorder&&this.audioRecorder.clear()},e.prototype.listeningFooterJSX=function(){var e=this,t=(0,$.h)("canvas",{height:"50"}),n=(0,$.h)("amplify-button",{"data-test":"chatbot-cancel-button",handleButtonClick:function(){return e.handleCancelButton()},class:"icon-button",variant:"icon",icon:"ban"});return[t,n]},e.prototype.footerJSX=function(){var e=this;if(this.chatState===Bt.Listening)return this.listeningFooterJSX();var t=this.textEnabled?G.T.TEXT_INPUT_PLACEHOLDER:G.T.VOICE_INPUT_PLACEHOLDER,n=(0,$.h)("amplify-input",{placeholder:q.o.get(t),description:"text",handleInputChange:function(t){return e.handleTextChange(t)},value:this.text,disabled:this.chatState===Bt.Error||!this.textEnabled}),i=this.voiceEnabled&&(0,$.h)("amplify-button",{"data-test":"chatbot-mic-button",handleButtonClick:function(){return e.handleMicButton()},class:"icon-button",variant:"icon",icon:"microphone",disabled:this.chatState===Bt.Error||this.chatState!==Bt.Initial}),o=this.textEnabled&&(0,$.h)("amplify-button",{"data-test":"chatbot-send-button",class:"icon-button",variant:"icon",icon:"send",handleButtonClick:function(){return e.sendTextMessage()},disabled:this.chatState===Bt.Error||this.chatState!==Bt.Initial});return[n,i,o]},e.prototype.errorToast=function(){var e=this;if(this.error){var t=this.error,n=t.message,i=t.errorType;return(0,$.h)("amplify-toast",{message:q.o.get(n),handleClose:function(){return e.handleToastClose(i)}})}},e.prototype.render=function(){var e=this;return(0,$.h)($.H,null,(0,$.h)("div",{class:"amplify-chatbot"},(0,$.h)("slot",{name:"header"},(0,$.h)("div",{class:"header","data-test":"chatbot-header"},q.o.get(this.botTitle))),(0,$.h)("div",{class:"body","data-test":"chatbot-body"},this.messageJSX(this.messages)),(0,$.h)("form",{onSubmit:function(t){return e.handleSubmit(t)}},(0,$.h)("div",{class:"footer","data-test":"chatbot-footer"},this.footerJSX())),this.errorToast()))},Object.defineProperty(e.prototype,"element",{get:function(){return(0,$.g)(this)},enumerable:!1,configurable:!0}),e}();on.style=nn}}]);
//# sourceMappingURL=208.6e6dd585.js.map